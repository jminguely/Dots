function init(){setDimension(),myView=document.getElementById("grid"),renderer=PIXI.autoDetectRenderer(widthWindow,heightWindow,{view:myView,transparent:!0,antialias:!0,resolution:aspectRatio}),stage=new PIXI.Container,renderer.render(stage),graphics=new PIXI.Graphics,graphics2=new PIXI.Graphics,lines=new PIXI.Graphics,animationGraphics=new PIXI.Graphics,stage.addChild(graphics),stage.addChild(graphics2),stage.addChild(lines),stage.addChild(animationGraphics),document.onmousemove=mouseEventHandler,doneResizing(),render()}function resizeStart(){clearTimeout(resizeId),flushStage(),graphics.clear(),graphics2.clear(),animationGraphics.clear(),$("div.overlay").removeClass("visible").find(".content").html(""),resizeId=setTimeout(doneResizing,500)}function flushStage(){elements.forEach(function(e){e.graphics&&e.graphics.clear()})}function setDimension(){var e=window,i=document,t=i.documentElement,a=i.getElementsByTagName("body")[0];widthWindow=e.innerWidth||t.clientWidth||a.clientWidth,heightWindow=e.innerHeight||t.clientHeight||a.clientHeight,aspectRatio=window.devicePixelRatio}function doneResizing(){setDimension(),renderer.resize(widthWindow,heightWindow),cols=Math.ceil(widthWindow/(marginDot+2*radiusDot)),rows=Math.ceil(heightWindow/(marginDot+2*radiusDot)),drawGrid()}function drawGrid(){for(var e=0;cols>e;e++)for(var i=0;rows>i;i++){var t=e*(marginDot+2*radiusDot),a=i*(marginDot+2*radiusDot);graphics.beginFill("0x"+mainColor),graphics.drawCircle(t,a,radiusDot),graphics.endFill()}elements&&elements.forEach(function(e,i){var t=Math.round(cols/100*e.dotX),a=Math.round(rows/100*e.dotY);elements[i].graphics=new PIXI.Graphics,stage.addChild(elements[i].graphics),elements[i].graphics.beginFill("0x"+secondColor);for(var n=1;n>=-1;n--)for(var r=1;r>=-1;r--)if(Math.abs(n)!=Math.abs(r)||0===n&&0===r){var o=(t+n)*(marginDot+2*radiusDot),s=(a+r)*(marginDot+2*radiusDot);elements[i].graphics.drawCircle(o,s,radiusDot)}elements[i].graphics.endFill(),elements[i].graphics.interactive=!0,elements[i].graphics.buttonMode=!0,elements[i].graphics.defaultCursor="pointer";var d=2*(2*radiusDot+marginDot);elements[i].graphics.hitArea=new PIXI.Rectangle(t*(marginDot+2*radiusDot)-d,a*(marginDot+2*radiusDot)-d,2*d,2*d),elements[i].graphics.click=elements[i].graphics.tap=function(n){currentElementId===i?((e.type="html")&&closeOverlay(),(e.type="keywords")&&hideKeywords(),animationGraphics.clear(),currentElementId=void 0):(hideKeywords(),currentElementId=i,xBox=(t+e.overlayX)*(marginDot+2*radiusDot)-e.anchorX,yBox=(a+e.overlayY)*(marginDot+2*radiusDot)-e.anchorY,playAnimation(t,a,e.animation),(e.type="html")&&changeOverlayContent(e.src,xBox,yBox,e.w,e.h),(e.type="keywords")&&displayKeywords(e.content,xBox,yBox,e.w,e.h))}})}function playAnimation(e,i,t){animationGraphics.clear();var a=animations[t];for(var n in a){var r=a[n],o=[];for(var s in r)o.push([e+r[s][0],i+r[s][1]]);animationQueue.push(o)}}function hideKeywords(){for(var e in keywords)keywords[e].textObject.destroy();keywords=[]}function displayKeywords(e,i,t,a,n){var r=0,o=0,s=0,d=0;for(var l in e){var c=e[l],h=new PIXI.Text(c.toUpperCase(),{font:"bold 20px MuseoSans",fill:"#"+secondColor,stroke:"#FFFFFF",strokeThickness:3});h.pivot=new PIXI.Point(h.width/2,h.height/2),h.resolution=2;var m,f;d>0?(m=i-r,f=t+o+d):r>0?(m=i+r,f=t+2*o,s=h.width,d=h.height):(m=i,f=t),r=h.width,o=h.height,stage.addChild(h),h.x=i,h.y=t,keywords.push({textObject:h,x:m,y:f,baseX:i,baseY:t,objX:m+Math.round(Math.random()*defaultDistance-defaultDistance/2),objY:f+Math.round(Math.random()*defaultDistance-defaultDistance/2),lifespanAnimation:90,currentTimeAnimation:0})}}function closeOverlay(){$("div.overlay").removeClass("visible").css({top:0,width:0}),$("div.overlay .content").html("")}function changeOverlayContent(e,i,t,a,n){$("div.overlay").hasClass("visible")?($("div.overlay").removeClass("visible"),setTimeout(function(){$("div.overlay .content").html(e),$("div.overlay").addClass("visible").css({left:i,top:t,width:a,height:n})},300)):($("div.overlay").addClass("visible").css({left:i,top:t,width:a,height:n}),$("div.overlay .content").html(e))}function rgb(e){return e.match(/\w\w/g).map(function(e){return parseInt(e,16)})}function blendColor(e,i,t){for(var e=rgb(e),i=rgb(i),a=[],n=0;3>n;n++)a[n]=e[n]+t*(i[n]-e[n])|0;return a.map(function(e){return e.toString(16)}).map(function(e){return"00".slice(e.length)+e}).join("")}function touchEventHandler(e){interactionHandler(e.touches[0].clientX,e.touches[0].clientY)}function mouseEventHandler(e){interactionHandler(e.clientX,e.clientY)}function interactionHandler(e,i){for(var t=e/widthWindow,a=i/heightWindow,n=Math.round(cols*t),r=Math.round(rows*a),o=4,s=o,d=-s;s>=d;d++)for(var l=-s;s>=l;l++)if(n+d>=0&&cols>n+d&&r+l>=0&&rows>r+l){var c=n+d+"-"+(r+l),h=Math.max(Math.ceil(Math.sqrt(Math.pow(Math.abs(d),2)+Math.pow(Math.abs(l),2))),1);(!affectedDots.hasOwnProperty(c)||h<affectedDots[c].distance)&&(affectedDots[c]={distance:h,effet:h/Math.sqrt(Math.pow(s,2)+Math.pow(s,2)),x:n+d,y:r+l,lifespan:defaultLifespan})}}function render(){var e=(new Date).getTime(),i=(e-lastTickTime)/1e3,t=1/i;if(lowPerf=t>20?!1:!0,lowPerf||(graphics2.clear(),lines.clear()),lowPerf=t>20?!1:!0,!lowPerf)for(var a in affectedDots){affectedDots[a].lifespan=affectedDots[a].lifespan-1;var n=affectedDots[a],r=n.x*(marginDot+2*radiusDot),o=n.y*(marginDot+2*radiusDot),s=(1-n.effet)/defaultLifespan*affectedDots[a].lifespan;graphics2.beginFill("0x"+blendColor(mainColor,primColor,s)),graphics2.drawCircle(r,o,Math.max(radiusDot/n.effet/6,radiusDot)),graphics2.endFill(),affectedDots[a].lifespan<=0&&delete affectedDots[a]}for(var d in keywords){if(keyword=keywords[d],keyword.currentTimeAnimation>=keyword.lifespanAnimation){var l=Math.round(Math.random()*defaultLifespanAnimation)+defaultLifespanAnimation/2;keyword.lifespanAnimation=l,keyword.currentTimeAnimation=0,keywords[d].baseX=keywords[d].textObject.x,keywords[d].baseY=keywords[d].textObject.y,keywords[d].objX=keywords[d].x+Math.random()*defaultDistance-defaultDistance/2,keywords[d].objY=keywords[d].y+Math.random()*defaultDistance-defaultDistance/2}keyword.currentTimeAnimation++;var c=easeInOut(keyword.currentTimeAnimation,keywords[d].baseX,keywords[d].objX-keywords[d].baseX,keyword.lifespanAnimation),h=easeInOut(keyword.currentTimeAnimation,keywords[d].baseY,keywords[d].objY-keywords[d].baseY,keyword.lifespanAnimation);keyword.textObject.x=c,keyword.textObject.y=h;var m=parseInt(d)+1;parseInt(d)===keywords.length-1&&(m=0),lines.lineStyle(2,"0x"+primColor,1),lines.moveTo(keywords[d].textObject.x,keywords[d].textObject.y),lines.lineTo(keywords[m].textObject.x,keywords[m].textObject.y)}if(lastTickTime=e,!lowPerf&&(lastTickTime-lastAnimationTime>animationSpeed||void 0===lastAnimationTime)){if(void 0!==animationQueue[0]){var f=animationQueue.shift();for(dotId in f){var n=f[dotId],r=n[0]*(marginDot+2*radiusDot),o=n[1]*(marginDot+2*radiusDot);animationGraphics.beginFill("0x"+primColor),animationGraphics.drawCircle(r,o,radiusDot),animationGraphics.endFill()}}lastAnimationTime=lastTickTime}renderer.render(stage),requestAnimationFrame(render)}function easeInOut(e,i,t,a){return(e/=a/2)<1?t/2*e*e+i:-t/2*(--e*(e-2)-1)+i}var dots=[],resizeId,mainColor="e6e6e5",primColor="98c21f",secondColor="a773b4",widthWindow,heightWindow,aspectRatio,radiusDot=3,marginDot=5,cols=0,rows=0,currentElementId=void 0,renderer,stage,graphics;$(document).ready(init),window.onresize=resizeStart;var animationQueue=[],animationSpeed=40,keywords=[],affectedDots=[],defaultLifespan=20,lastCoord=[],lastTickTime,lastAnimationTime,defaultLifespanAnimation=200,defaultDistance=20,lowPerf=!1;Object.size=function(e){var i=0,t;for(t in e)e.hasOwnProperty(t)&&i++;return i};