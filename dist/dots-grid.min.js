function initializeGrid(){WebFont.load({custom:{families:["CustomMuseoSansBold"]},active:function(){init()}})}function init(){setDimension(),myView=document.getElementById("grid"),renderer=PIXI.autoDetectRenderer(widthWindow,heightWindow,{view:myView,transparent:!0,antialias:!0,resolution:aspectRatio}),stage=new PIXI.Container,renderer.render(stage),graphics=new PIXI.Graphics,graphics2=new PIXI.Graphics,lines=new PIXI.Graphics,animationGraphics=new PIXI.Graphics,stage.addChild(graphics),stage.addChild(graphics2),stage.addChild(lines),stage.addChild(animationGraphics),document.onmousemove=mouseEventHandler,doneResizing(),render()}function resizeStart(){clearTimeout(resizeId),flushStage(),graphics.clear(),graphics2.clear(),animationGraphics.clear(),$("div.overlay").removeClass("visible").find(".content").html(""),resizeId=setTimeout(doneResizing,500)}function flushStage(){"undefined"!=typeof gridElements&&gridElements.forEach(function(e){e.graphics&&e.graphics.clear()})}function setDimension(){widthWindow=$("#grid").width(),heightWindow=$("#grid").height(),aspectRatio=window.devicePixelRatio}function doneResizing(){setDimension(),renderer.resize(widthWindow,heightWindow),cols=Math.ceil(widthWindow/(marginDot+2*radiusDot)),rows=Math.ceil(heightWindow/(marginDot+2*radiusDot)),drawGrid()}function drawGrid(){for(var e=0;cols>e;e++)for(var i=0;rows>i;i++){var t=e*(marginDot+2*radiusDot),a=i*(marginDot+2*radiusDot);graphics.beginFill("0x"+mainColor),graphics.drawCircle(t,a,radiusDot),graphics.endFill()}"undefined"!=typeof gridElements&&gridElements.forEach(function(e,i){var t=Math.round(cols/100*e.dotX),a=Math.round(rows/100*e.dotY);gridElements[i].graphics=new PIXI.Graphics,stage.addChild(gridElements[i].graphics),gridElements[i].graphics.beginFill("0x"+secondColor);for(var r=1;r>=-1;r--)for(var n=1;n>=-1;n--)if(Math.abs(r)!=Math.abs(n)||0===r&&0===n){var o=(t+r)*(marginDot+2*radiusDot),s=(a+n)*(marginDot+2*radiusDot);gridElements[i].graphics.drawCircle(o,s,radiusDot)}gridElements[i].graphics.endFill(),gridElements[i].graphics.interactive=!0,gridElements[i].graphics.buttonMode=!0,gridElements[i].graphics.defaultCursor="pointer";var d=2*(2*radiusDot+marginDot);gridElements[i].graphics.hitArea=new PIXI.Rectangle(t*(marginDot+2*radiusDot)-d,a*(marginDot+2*radiusDot)-d,2*d,2*d),gridElements[i].graphics.click=gridElements[i].graphics.tap=function(r){currentElementId===i?((e.type="html")&&closeOverlay(),(e.type="keywords")&&hideKeywords(),animationGraphics.clear(),currentElementId=void 0):(hideKeywords(),currentElementId=i,xBox=(t+e.overlayX)*(marginDot+2*radiusDot)-e.anchorX,yBox=(a+e.overlayY)*(marginDot+2*radiusDot)-e.anchorY,playAnimation(t,a,e.animation),(e.type="html")&&changeOverlayContent(e.src,xBox,yBox,e.w,e.h),(e.type="keywords")&&displayKeywords(e.content,xBox,yBox,e.w,e.h))}})}function playAnimation(e,i,t){animationGraphics.clear();var a=animations[t];for(var r in a){var n=a[r],o=[];for(var s in n)o.push([e+n[s][0],i+n[s][1]]);animationQueue.push(o)}}function hideKeywords(){for(var e in keywords)keywords[e].textObject.destroy();keywords=[]}function displayKeywords(e,i,t){var a=0,r=0,n=0,o=0;for(var s in e){var d=e[s],l=new PIXI.Text(d.toUpperCase(),{font:"20px CustomMuseoSansBold",fill:"#"+secondColor,stroke:"#FFFFFF",strokeThickness:3});l.pivot=new PIXI.Point(l.width/2,l.height/2),l.resolution=2;var c,h;o>0?(c=i-a,h=t+r+o):a>0?(c=i+a,h=t+2*r,n=l.width,o=l.height):(c=i,h=t),a=l.width,r=l.height,stage.addChild(l),l.x=i,l.y=t,keywords.push({textObject:l,x:c,y:h,baseX:i,baseY:t,objX:c+Math.round(Math.random()*defaultDistance-defaultDistance/2),objY:h+Math.round(Math.random()*defaultDistance-defaultDistance/2),lifespanAnimation:90,currentTimeAnimation:0})}}function closeOverlay(){$("div.overlay").removeClass("visible").css({top:0,width:0}),$("div.overlay .content").html("")}function changeOverlayContent(e,i,t,a,r){0>=i&&(i=0),0>=t&&(t=0),i+a>widthWindow&&(i=widthWindow-a),t+r>heightWindow&&(t=heightWindow-r),$("div.overlay").hasClass("visible")?($("div.overlay").removeClass("visible"),setTimeout(function(){$("div.overlay .content").html(e),$("div.overlay").addClass("visible").css({left:i,top:t,width:a,height:r})},300)):($("div.overlay").addClass("visible").css({left:i,top:t,width:a,height:r}),$("div.overlay .content").html(e))}function rgb(e){return e.match(/\w\w/g).map(function(e){return parseInt(e,16)})}function blendColor(e,i,t){for(var e=rgb(e),i=rgb(i),a=[],r=0;3>r;r++)a[r]=e[r]+t*(i[r]-e[r])|0;return a.map(function(e){return e.toString(16)}).map(function(e){return"00".slice(e.length)+e}).join("")}function mouseEventHandler(e){var i=$("#grid").offset(),t=e.pageX-i.left,a=e.pageY-i.top;interactionHandler(t,a)}function interactionHandler(e,i){for(var t=e/widthWindow,a=i/heightWindow,r=Math.round(cols*t),n=Math.round(rows*a),o=4,s=o,d=-s;s>=d;d++)for(var l=-s;s>=l;l++)if(r+d>=0&&cols>r+d&&n+l>=0&&rows>n+l){var c=r+d+"-"+(n+l),h=Math.max(Math.ceil(Math.sqrt(Math.pow(Math.abs(d),2)+Math.pow(Math.abs(l),2))),1);(!affectedDots.hasOwnProperty(c)||h<affectedDots[c].distance)&&(affectedDots[c]={distance:h,effet:h/Math.sqrt(Math.pow(s,2)+Math.pow(s,2)),x:r+d,y:n+l,lifespan:defaultLifespan})}}function render(){var e=(new Date).getTime(),i=(e-lastTickTime)/1e3,t=1/i;if(lowPerf=t>20?!1:!0,lowPerf||(graphics2.clear(),lines.clear()),lowPerf=t>20?!1:!0,!lowPerf)for(var a in affectedDots){affectedDots[a].lifespan=affectedDots[a].lifespan-1;var r=affectedDots[a],n=r.x*(marginDot+2*radiusDot),o=r.y*(marginDot+2*radiusDot),s=(1-r.effet)/defaultLifespan*affectedDots[a].lifespan;graphics2.beginFill("0x"+blendColor(mainColor,primColor,s)),graphics2.drawCircle(n,o,Math.max(radiusDot/r.effet/6,radiusDot)),graphics2.endFill(),affectedDots[a].lifespan<=0&&delete affectedDots[a]}for(var d in keywords){if(keyword=keywords[d],keyword.currentTimeAnimation>=keyword.lifespanAnimation){var l=Math.round(Math.random()*defaultLifespanAnimation)+defaultLifespanAnimation/2;keyword.lifespanAnimation=l,keyword.currentTimeAnimation=0,keywords[d].baseX=keywords[d].textObject.x,keywords[d].baseY=keywords[d].textObject.y,keywords[d].objX=keywords[d].x+Math.random()*defaultDistance-defaultDistance/2,keywords[d].objY=keywords[d].y+Math.random()*defaultDistance-defaultDistance/2}keyword.currentTimeAnimation++;var c=easeInOut(keyword.currentTimeAnimation,keywords[d].baseX,keywords[d].objX-keywords[d].baseX,keyword.lifespanAnimation),h=easeInOut(keyword.currentTimeAnimation,keywords[d].baseY,keywords[d].objY-keywords[d].baseY,keyword.lifespanAnimation);keyword.textObject.x=c,keyword.textObject.y=h;var m=parseInt(d)+1;parseInt(d)===keywords.length-1&&(m=0),lines.lineStyle(2,"0x"+primColor,1),lines.moveTo(keywords[d].textObject.x,keywords[d].textObject.y),lines.lineTo(keywords[m].textObject.x,keywords[m].textObject.y)}if(lastTickTime=e,!lowPerf&&(lastTickTime-lastAnimationTime>animationSpeed||void 0===lastAnimationTime)){if(void 0!==animationQueue[0]){var f=animationQueue.shift();for(dotId in f){var r=f[dotId],n=r[0]*(marginDot+2*radiusDot),o=r[1]*(marginDot+2*radiusDot);animationGraphics.beginFill("0x"+primColor),animationGraphics.drawCircle(n,o,radiusDot),animationGraphics.endFill()}}lastAnimationTime=lastTickTime}renderer.render(stage),requestAnimationFrame(render)}function easeInOut(e,i,t,a){return(e/=a/2)<1?t/2*e*e+i:-t/2*(--e*(e-2)-1)+i}var dots=[],resizeId,mainColor="e6e6e5",primColor="98c21f",secondColor="a773b4",widthWindow,heightWindow,aspectRatio,radiusDot=3,marginDot=5,cols=0,rows=0,currentElementId=void 0,renderer,stage,graphics,lastTickTime,lastAnimationTime,defaultLifespanAnimation=200,defaultDistance=20,lowPerf=!1,animationQueue=[],animationSpeed=40,keywords=[],affectedDots=[],defaultLifespan=20,lastCoord=[],animations=[[[[-3,-3]],[[-2,-2]],[[-1,-1]],[[0,0]],[[1,1]],[[2,2]],[[3,3]]],[[[3,-3]],[[2,-2]],[[1,-1]],[[0,0]],[[-1,1]],[[-2,2]],[[-3,3]]],[[[0,-2],[0,2],[2,0],[-2,0]],[[0,-3],[0,3],[3,0],[-3,0]],[[0,-4],[0,4],[4,0],[-4,0]],[[0,-5],[0,5],[5,0],[-5,0]],[[0,-6],[0,6],[6,0],[-6,0]]],[[[0,-2],[0,2],[2,0],[-2,0]],[[0,-3],[-3,0]],[[0,-4],[-4,0]],[[0,-5],[-4,0]],[[0,-6],[-5,0]]],[[[0,-2],[0,2],[2,0],[-2,0]],[[0,-3],[3,0]],[[0,-4],[4,0]]],[[[0,-2],[0,2],[2,0],[-2,0]],[[0,3],[3,0]],[[0,4],[4,0]]],[[[0,-2],[0,2],[2,0],[-2,0]],[[0,3],[-3,0]],[[0,4],[-4,0]]],[[[-4,-4]],[[-3,-3]],[[-2,-2]],[[-1,-1]],[[0,0]],[[1,0]],[[2,0]],[[3,0]]],[[[4,-4]],[[3,-3]],[[2,-2]],[[1,-1]],[[0,0]],[[-1,0]],[[-2,0]],[[-3,0]]],[[[4,-4]],[[3,-3]],[[2,-2]],[[1,-1]],[[0,0]],[[-1,1]],[[-2,2]],[[-2,1],[-1,2]],[[-2,0],[0,2]],[[-2,-1],[1,2]]],[[[-4,-4]],[[-3,-3]],[[-2,-2]],[[-1,-1]],[[0,0]],[[1,1]],[[2,2]],[[2,1],[1,2]],[[2,0],[0,2]],[[2,-1],[-1,2]]],[[[-5,2],[2,-5]],[[-5,1],[-4,2],[1,-5],[2,-4]],[[-5,0],[-3,2],[0,-5],[2,-3]],[[-5,-1],[-2,2],[-1,-5],[2,-2]],[[-5,-2],[-1,2],[-2,-5],[2,-1]],[[-5,-3],[0,2],[-3,-5],[2,0]],[[-5,-4],[1,2],[-4,-5],[2,1]],[[-5,-5],[2,2],[-5,-5],[2,2]],[[-4,1],[1,-4]],[[-4,0],[-3,1],[0,-4],[1,-3]],[[-4,-1],[-2,1],[-1,-4],[1,-2]],[[-4,-2],[-1,1],[-2,-4],[1,-1]],[[-4,-3],[-3,-4]],[[-4,-4],[1,1],[-4,-4],[1,1]],[[-3,0],[0,-3]],[[-3,-1],[-1,-3],[0,-2]],[[-3,-2],[-2,-3]],[[-3,-3],[-3,-3]],[[-2,-1],[-1,-2]],[[-2,-2],[-2,-2],[-1,-1]],[[-2,0]]]];window.onresize=resizeStart;